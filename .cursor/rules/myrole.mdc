---
alwaysApply: true
---

---

description: 这份规则文档提供了代码审查的最佳实践和编码标准，重点关注代码质量、安全性和性能优化，以确保代码的可靠性和可维护性。
globs: \_.cpp, \_.h, \*.hpp, \*.ts

---

# 代码审查规则和最佳实践

本文档提供了全面的代码审查指南，涵盖代码组织、常见模式、性能考虑、安全性最佳实践和常见陷阱等方面。

## 规则信息:

-   名称: 代码审查规则
-   版本: 1.0.1
-   标签: cpp, ts, safety, quality

## 1. 代码质量规范

-   **Linux 编译限制:**
    -   逻辑运算符使用规范：
        -   当`||`和`&&`结合使用时，必须使用括号明确优先级。按照 Linux 的编译要求来规范。
        -   错误示例: `A && B || C && D`, `(E && (A && B || C && D))`
        -   正确示例: `(A && B) || (C && D)`
    -   严重程度: 错误
    -   必须修复

## 2. 安全性规范

-   **空指针检查:**

    -   所有指针使用前必须进行空指针检查
    -   建议使用智能指针管理内存
    -   严重程度: 错误
    -   必须修复

-   **资源管理:**

    -   确保所有资源在使用后被正确释放
    -   使用 RAII 模式管理资源
    -   避免资源泄漏
    -   严重程度: 错误
    -   必须修复

-   **循环控制:**
    -   **死循环预防:**
        -   确保循环逻辑不会形成死循环
        -   在可能出现死循环的地方加入保护代码
        -   使用循环计数器或超时机制
    -   严重程度: 错误/提示
    -   状态: 错误必须修复，提示可优化

## 3. 审查流程

-   **步骤 1: 代码规范性检查**

    -   检查代码格式
    -   检查命名规范
    -   检查注释完整性

-   **步骤 2: 代码质量检查**

    -   检查代码复杂度
    -   检查代码重复
    -   检查代码可维护性

-   **步骤 3: 业务逻辑检查**

    -   验证业务逻辑正确性
    -   检查边界条件处理
    -   检查异常处理

-   **步骤 4: 性能检查**

    -   检查算法复杂度
    -   检查资源使用效率
    -   检查性能瓶颈

-   **步骤 5: 安全性检查**
    -   检查内存管理
    -   检查并发安全
    -   检查输入验证

## 4. 严重程度说明

-   **错误 (Error)**

    -   必须修复
    -   影响程序正确性或安全性
    -   可能导致程序崩溃或安全漏洞

-   **警告 (Warning)**

    -   建议修复
    -   可能影响程序性能或可维护性
    -   不会直接导致程序错误

-   **提示 (Info)**

    -   可以优化
    -   代码质量改进建议

    -   不影响程序功能

# AI 助手核心规则

## 三阶段工作流

### 阶段一：分析问题

**声明格式**：`【分析问题】`

**目的**
因为可能存在多个可选方案，要做出正确的决策，需要足够的依据。

**必须做的事**：

-   理解我的意图，如果有歧义请问我
-   搜索所有相关代码
-   识别问题根因

**主动发现问题**

-   发现重复代码
-   识别不合理的命名
-   发现多余的代码、类
-   发现可能过时的设计
-   发现过于复杂的设计、调用
-   发现不一致的类型定义
-   进一步搜索代码，看是否更大范围内有类似问题

做完以上事项，就可以向我提问了。

**绝对禁止**：

-   ❌ 修改任何代码
-   ❌ 急于给出解决方案
-   ❌ 跳过搜索和理解步骤
-   ❌ 不分析就推荐方案

**阶段转换规则**
本阶段你要向我提问。
如果存在多个你无法抉择的方案，要问我，作为提问的一部分。
如果没有需要问我的，则直接进入下一阶段。

### 阶段二：制定方案

**声明格式**：`【制定方案】`

**前置条件**：

-   我明确回答了关键技术决策。

**必须做的事**：

-   列出变更（新增、修改、删除）的文件，简要描述每个文件的变化
-   消除重复逻辑：如果发现重复代码，必须通过复用或抽象来消除
-   确保修改后的代码符合 DRY 原则和良好的架构设计

如果新发现了向我收集的关键决策，在这个阶段你还可以继续问我，直到没有不明确的问题之后，本阶段结束。
本阶段不允许自动切换到下一阶段。

### 阶段三：执行方案

**声明格式**：`【执行方案】`

**必须做的事**：

-   严格按照选定方案实现
-   修改后运行类型检查

**绝对禁止**：

-   ❌ 提交代码（除非用户明确要求）
-   启动开发服务器

如果在这个阶段发现了拿不准的问题，请向我提问。

收到用户消息时，一般从【分析问题】阶段开始，除非用户明确指定阶段的名字。

